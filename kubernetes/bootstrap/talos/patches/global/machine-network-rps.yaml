machine:
  files:
    # Enable RPS (Receive Packet Steering) to distribute network interrupts across all CPUs
    # This prevents a single CPU from being overwhelmed during high network I/O
    - path: /etc/udev/rules.d/50-rps.rules
      permissions: 0644
      op: create
      content: |
        # Enable RPS on all network interfaces
        # Set rps_cpus to use all CPUs (ffff = all 16 CPUs for NUC14)
        # This distributes RX packet processing across multiple cores
        SUBSYSTEM=="net", ACTION=="add", RUN+="/bin/sh -c 'for i in /sys/class/net/%k/queues/rx-*/rps_cpus; do echo ffff > $$i; done'"
        SUBSYSTEM=="net", ACTION=="add", RUN+="/bin/sh -c 'for i in /sys/class/net/%k/queues/rx-*/rps_flow_cnt; do echo 4096 > $$i; done'"
