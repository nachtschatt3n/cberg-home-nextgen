---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: longhorn
  namespace: storage
spec:
  interval: 5m
  chart:
    spec:
      chart: longhorn
      version: "1.6.0"
      sourceRef:
        kind: HelmRepository
        name: longhorn
        namespace: flux-system
  values:
    longhorn:
      namespaceOverride: storage
      defaultSettings:
        defaultDataPath: /var/lib/longhorn
        replicaSoftAntiAffinity: true
        replicaAutoBalance: true
        createDefaultDiskLabeledNodes: true
        defaultReplicaCount: 2
        guaranteedEngineManagerCPU: 12
        guaranteedReplicaManagerCPU: 12
        defaultLonghornStaticStorageClass: longhorn
        backupTarget: "cifs://192.168.31.230/backups"
        backupTargetCredentialSecret: "csi-driver-smb"
        allowRecurringJobWhileVolumeDetached: true
        storageOverProvisioningPercentage: 100
        storageMinimalAvailablePercentage: 25
        upgradeChecker: true
        backupstorePollInterval: 300
        taintToleration: ""
        systemManagedComponentsNodeSelector: ""
        allowNodeDrainWithLastHealthyReplica: true
        nodeDrainPolicy: block-if-contains-last-replica
        offlineReplicaRebuilding: enabled
        disableSchedulingOnCordonedNode: true
        replicaZoneSoftAntiAffinity: true
        removeSnapshotsDuringFilesystemTrim: enabled
        snapshotDataIntegrity: enabled
        snapshotDataIntegrityImmediateCheckAfterSnapshotCreation: disabled
        autoSalvage: enabled
        autoDeletePodWhenVolumeDetachedUnexpectedly: true
        replicaReplenishmentWaitInterval: 600
        concurrentReplicaRebuildPerNodeLimit: 5
        systemManagedPodsImagePullPolicy: if-not-present
        allowVolumeCreationWithDegradedAvailability: true
        mkfsExt4Parameters: ""
        priorityClass: ""
        disableReplicaRebuild: false
      persistence:
        defaultClass: true
        defaultClassReplicaCount: 2
      ui:
        enabled: true
        service:
          type: ClusterIP
      csi:
        kubeletRootDir: /var/lib/kubelet
