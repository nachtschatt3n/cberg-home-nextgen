---
apiVersion: v1
kind: ConfigMap
metadata:
  name: authentik-blueprints
  namespace: kube-system
data:
  # All Authentik resources managed via blueprints for GitOps
  # Note: Using UUIDs directly for flows since they already exist
  # Authorization flow UUID: 0cdf1b8c-88f9-4b90-a063-a14e18192f74 (default-provider-authorization-implicit-consent)
  # Invalidation flow UUID: b8a97e00-f02f-48d9-b854-b26bf837779c (default-provider-invalidation-flow)
  # Service Connection UUID: 162f6c4f-053d-4a1a-9aa6-d8e590c49d70 (Local Kubernetes Cluster)
  all-blueprints.yaml: |
    version: 1
    entries:
      # ============================================================================
      # Frigate Forward Auth Integration
      # ============================================================================
      - id: frigate-forward-auth-provider
        model: authentik_providers_proxy.proxyprovider
        state: present
        identifiers:
          name: frigate-forward-auth
        attrs:
          name: frigate-forward-auth
          mode: forward_single
          external_host: "https://frigate.example.com"
          internal_host: "http://frigate.home-automation.svc.cluster.local:5000"
          skip_path_regex: ""
          authorization_flow: "0cdf1b8c-88f9-4b90-a063-a14e18192f74"
          invalidation_flow: "b8a97e00-f02f-48d9-b854-b26bf837779c"

      - id: frigate-application
        model: authentik_core.application
        state: present
        identifiers:
          slug: frigate
        attrs:
          name: Frigate NVR
          slug: frigate
          provider: !KeyOf frigate-forward-auth-provider
          meta_launch_url: "https://frigate.example.com"
          meta_icon: "https://raw.githubusercontent.com/walkxcode/dashboard-icons/main/png/frigate.png"
          meta_description: "Frigate NVR - Home surveillance system with AI object detection"

      - id: frigate-outpost
        model: authentik_outposts.outpost
        state: present
        identifiers:
          name: frigate-forward-auth
        attrs:
          name: frigate-forward-auth
          type: proxy
          providers:
            - !KeyOf frigate-forward-auth-provider
          service_connection: "162f6c4f-053d-4a1a-9aa6-d8e590c49d70"
          config:
            authentik_host: "https://auth.example.com"
            docker_network: null
            docker_map_ports: true
            docker_labels: {}
            kubernetes_namespace: kube-system
            kubernetes_replicas: 1
            kubernetes_ingress_class_name: ""
            kubernetes_ingress_secret_name: ""
            kubernetes_ingress_annotations: {}
            kubernetes_service_type: "ClusterIP"
            kubernetes_service_annotations: {}
            kubernetes_disabled_components: []
            container_network: null

      # ============================================================================
      # phpMyAdmin Forward Auth Integration
      # ============================================================================
      - id: phpmyadmin-forward-auth-provider
        model: authentik_providers_proxy.proxyprovider
        state: present
        identifiers:
          name: phpmyadmin-forward-auth
        attrs:
          name: phpmyadmin-forward-auth
          mode: forward_single
          external_host: "https://phpmyadmin.example.com"
          internal_host: "http://phpmyadmin.databases.svc.cluster.local:80"
          skip_path_regex: ""
          authorization_flow: "0cdf1b8c-88f9-4b90-a063-a14e18192f74"
          invalidation_flow: "b8a97e00-f02f-48d9-b854-b26bf837779c"

      - id: phpmyadmin-application
        model: authentik_core.application
        state: present
        identifiers:
          slug: phpmyadmin
        attrs:
          name: phpMyAdmin
          slug: phpmyadmin
          provider: !KeyOf phpmyadmin-forward-auth-provider
          meta_launch_url: "https://phpmyadmin.example.com"
          meta_icon: "https://raw.githubusercontent.com/walkxcode/dashboard-icons/main/png/phpmyadmin.png"
          meta_description: "Web-based MySQL/MariaDB administration tool"

      - id: phpmyadmin-outpost
        model: authentik_outposts.outpost
        state: present
        identifiers:
          name: phpmyadmin-forward-auth
        attrs:
          name: phpmyadmin-forward-auth
          type: proxy
          providers:
            - !KeyOf phpmyadmin-forward-auth-provider
          service_connection: "162f6c4f-053d-4a1a-9aa6-d8e590c49d70"
          config:
            authentik_host: "https://auth.example.com"
            docker_network: null
            docker_map_ports: true
            docker_labels: {}
            kubernetes_namespace: kube-system
            kubernetes_replicas: 1
            kubernetes_ingress_class_name: ""
            kubernetes_ingress_secret_name: ""
            kubernetes_ingress_annotations: {}
            kubernetes_service_type: "ClusterIP"
            kubernetes_service_annotations: {}
            kubernetes_disabled_components: []
            container_network: null

      # ============================================================================
      # Longhorn Proxy Mode Integration
      # ============================================================================
      - id: longhorn-proxy-provider
        model: authentik_providers_proxy.proxyprovider
        state: present
        identifiers:
          name: longhorn-proxy
        attrs:
          name: longhorn-proxy
          mode: proxy
          external_host: "https://longhorn.example.com"
          internal_host: "http://longhorn-frontend.storage.svc.cluster.local:80"
          skip_path_regex: ""
          authorization_flow: "0cdf1b8c-88f9-4b90-a063-a14e18192f74"
          invalidation_flow: "b8a97e00-f02f-48d9-b854-b26bf837779c"

      - id: longhorn-application
        model: authentik_core.application
        state: present
        identifiers:
          slug: longhorn
        attrs:
          name: Longhorn
          slug: longhorn
          provider: !KeyOf longhorn-proxy-provider
          meta_launch_url: "https://longhorn.example.com"
          meta_icon: "https://raw.githubusercontent.com/walkxcode/dashboard-icons/main/png/longhorn.png"
          meta_description: "Kubernetes storage management UI"

      - id: longhorn-outpost
        model: authentik_outposts.outpost
        state: present
        identifiers:
          name: longhorn-proxy-outpost
        attrs:
          name: longhorn-proxy-outpost
          type: proxy
          providers:
            - !KeyOf longhorn-proxy-provider
          service_connection: "162f6c4f-053d-4a1a-9aa6-d8e590c49d70"
          config:
            authentik_host: "https://auth.example.com"
            docker_network: null
            docker_map_ports: true
            docker_labels: {}
            kubernetes_namespace: kube-system
            kubernetes_replicas: 1
            kubernetes_ingress_class_name: "internal"
            kubernetes_ingress_secret_name: ""
            kubernetes_ingress_annotations:
              nginx.ingress.kubernetes.io/affinity: cookie
              nginx.ingress.kubernetes.io/proxy-buffer-size: 16k
              nginx.ingress.kubernetes.io/proxy-buffers-number: "4"
              nginx.ingress.kubernetes.io/proxy-busy-buffers-size: 32k
              traefik.ingress.kubernetes.io/affinity: "true"
              traefik.ingress.kubernetes.io/router.tls: "true"
            kubernetes_service_type: "ClusterIP"
            kubernetes_service_annotations: {}
            kubernetes_disabled_components: []
            container_network: null

